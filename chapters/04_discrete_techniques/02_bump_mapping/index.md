凹凸贴图是（Bump Mapping）是一种通过扰动表面的法向量来改变光照渲染效果的技术。这种技术可以在不生成网格表面的情况下渲染复杂、较为真实的物体表面效果。

## 法线贴图

法线贴图是其中一种凹凸贴图技术，其将表面上的法线保存在贴图的是 RGB 分量中，然后作为普通的纹理传递给 WebGL 片元着色器中。在片元着色器中，贴图中的像素会和普通纹理一样被读取，被读取出来的RGB颜色值会被归一化为法向量，最后在计算光照效果的时候使用使用这个法向量，这样就可以得到较为逼真的渲染效果。但即使法线贴图能提供改变法向量的能力，但毕竟不是真实的几何图形，实际的渲染效果还是会与真实几何物体存在较大区别，如从侧面观察的时候表面不会有任何起伏，也无法为其他表面提供阴影效果等。

由于绝大部分 RGB 图像使用 Uint8 的整数类型保存数据，而 WebGL 中法向量是由浮点数构成的向量，因此通用法线贴图一般采用以下 RGB 到 XYZ 映射：
  - R 分量数值 [0, 255] 映射为法向量 X 分量 [-1, 1]
  - G 分量数值 [0, 255] 映射为法向量 Y 分量 [-1, 1]
  - Z 分量数值 [127, 255] 映射为法向量 Z 分量 [0, 1]。因此将法线贴图从纹理空间映射至裁剪空间时，默认法线贴图始终朝向 Z 正方向。

### 切向量空间

切向量空间是一个局部坐标系统，由目标点法向量、目标点切向量以及两者的叉积构成的坐标系。与普通的纹理采样不同，法线贴图采样出来的是法向量，法向量是有方向的，如果一个表面的法向量和法线贴图的朝向不一致（表面的法向量不为 $(0, 0, 1)$），那么从法线贴图采样出来的法向量就无法使用。为了让法线贴图采样出来的法向量与表面片元对应起来，我们需要知道纹理空间到切向量空间之间的转换关系，然后在片元着色器中将采样出来的法向量从纹理空间转换到片元所在的切向量空间，以保证法向量的方向正确。

> 本章并没有介绍如何生成法线贴图，因为一般场景下，法线贴图都是使用第三方软件提前生成好的，并且绝大多数复杂的法线贴图生成的过程都是需要使用到实际的几何网格的。为了简化代码内容以着重介绍法线贴图的使用方式，所以本章不介绍相关的生成过程。而本章使用的到的法线贴图来自于 [https://en.wikipedia.org/wiki/Normal_mapping](https://en.wikipedia.org/wiki/Normal_mapping)